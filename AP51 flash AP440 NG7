#!/bin/bash

# Function to update and install ap51-flash package
install_ap51_flash() {
    echo "Step 1: Updating and installing ap51-flash package..."
    opkg update
    opkg install ap51-flash
    echo "Step 1 completed."
}

# Function to download firmware to /tmp directory
download_firmware() {
    echo "Step 2: Downloading firmware..."
    cd /tmp
    curl -O http://files.cloudtrax.com/downloads/firmware/7.0.17/openwrt-ipq807x-datto_ap440-squashfs-factory.bin.signed
    echo "Step 2 completed."
}

# Function to flash firmware using ap51-flash
flash_firmware() {
    echo "Step 3: Flashing firmware..."
    ap51-flash eth0 openwrt-ipq807x-datto_ap440-squashfs-factory.bin.signed
    echo "Step 3 completed."
}

# Main function
main() {
    echo "Firmware Flashing Tool for AP440 NG7"
    echo "-----------------------------------"
    install_ap51_flash
    download_firmware
    flash_firmware
    echo "Firmware flashing process completed."
}

# Call the main function
main
