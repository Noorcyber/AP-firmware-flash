#!/bin/bash

# Function to display the design "Datto Netrunners"
display_datto_netrunners() {
    cat << "EOF"

                                                                                                                                                                                                                                        
888b      88                       88888888ba                                                                                        db         88888888ba   8888888888    88             ad88  88                         88           
8888b     88                ,d     88      "8b                                                                                      d88b        88      "8b  88          ,d88            d8"    88                         88           
88 `8b    88                88     88      ,8P                                                                                     d8'`8b       88      ,8P  88  ____  888888            88     88                         88           
88  `8b   88   ,adPPYba,  MM88MMM  88aaaaaa8P'  88       88  8b,dPPYba,   8b,dPPYba,    ,adPPYba,  8b,dPPYba,  ,adPPYba,          d8'  `8b      88aaaaaa8P'  88a8PPPP8b,   88          MM88MMM  88  ,adPPYYba,  ,adPPYba,  88,dPPYba,   
88   `8b  88  a8P_____88    88     88""""88'    88       88  88P'   `"8a  88P'   `"8a  a8P_____88  88P'   "Y8  I8[    ""         d8YaaaaY8b     88""""""'    PP"     `8b   88  aaaaaaaa  88     88  ""     `Y8  I8[    ""  88P'    "8a  
88    `8b 88  8PP"""""""    88     88    `8b    88       88  88       88  88       88  8PP"""""""  88           `"Y8ba,         d8""""""""8b    88                    d8   88  """"""""  88     88  ,adPPPPP88   `"Y8ba,   88       88  
88     `8888  "8b,   ,aa    88,    88     `8b   "8a,   ,a88  88       88  88       88  "8b,   ,aa  88          aa    ]8I       d8'        `8b   88           Y8a     a8P   88            88     88  88,    ,88  aa    ]8I  88       88  
88      `888   `"Ybbd8"'    "Y888  88      `8b   `"YbbdP'Y8  88       88  88       88   `"Ybbd8"'  88          `"YbbdP"'      d8'          `8b  88            "Y88888P"    88            88     88  `"8bbdP"Y8  `"YbbdP"'  88       88  
                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                        

  By Noor Shaheed, Datto, Kaseya. 09/08/2023    Netrunners ap51-flash tool V.01
EOF
}

# Function to update and install ap51-flash package
install_ap51_flash() {
    echo "Step 1: Updating and installing ap51-flash package..."
    opkg update
    opkg install ap51-flash
    echo "Step 1 completed."
}

# Function to download firmware to /tmp directory
download_firmware() {
    echo "Step 2: Downloading firmware..."
    cd /tmp
    curl -O http://files.cloudtrax.com/downloads/firmware/7.0.17/openwrt-ipq807x-datto_ap440-squashfs-factory.bin.signed
    echo "Step 2 completed."
}

# Function to flash firmware using ap51-flash
flash_firmware() {
    echo "Step 3: Flashing firmware..."
    ap51-flash eth0 openwrt-ipq807x-datto_ap440-squashfs-factory.bin.signed
    echo "Step 3 completed."
}

# Main function
main() {
    # Display the design "Datto Netrunners"
    display_datto_netrunners

    echo "Firmware Flashing Tool for AP440 NG7"
    echo "-----------------------------------"
    install_ap51_flash
    download_firmware
    flash_firmware
    echo "Firmware flashing process completed."
}

# Call the main function
main
